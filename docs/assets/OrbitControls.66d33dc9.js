import{Loader as e,LoaderUtils as t,FileLoader as n,Color as s,SpotLight as o,PointLight as r,DirectionalLight as a,MeshBasicMaterial as i,MeshPhysicalMaterial as c,Vector2 as l,TangentSpaceNormalMap as u,ImageBitmapLoader as h,TextureLoader as p,InterleavedBuffer as d,InterleavedBufferAttribute as m,BufferAttribute as f,RGBFormat as g,LinearFilter as T,LinearMipmapLinearFilter as b,RepeatWrapping as x,PointsMaterial as v,Material as E,LineBasicMaterial as y,MeshStandardMaterial as R,DoubleSide as w,sRGBEncoding as A,PropertyBinding as M,BufferGeometry as S,SkinnedMesh as _,Mesh as L,LineSegments as O,Line as P,LineLoop as N,Points as I,Group as C,PerspectiveCamera as H,MathUtils as U,OrthographicCamera as k,InterpolateLinear as D,AnimationClip as F,Bone as j,Object3D as G,Matrix4 as K,Skeleton as B,TriangleFanDrawMode as V,Interpolant as X,NearestFilter as z,NearestMipmapNearestFilter as Y,LinearMipmapNearestFilter as q,NearestMipmapLinearFilter as Z,ClampToEdgeWrapping as W,MirroredRepeatWrapping as Q,InterpolateDiscrete as J,FrontSide as $,Texture as ee,TriangleStripDrawMode as te,VectorKeyframeTrack as ne,QuaternionKeyframeTrack as se,NumberKeyframeTrack as oe,Box3 as re,Vector3 as ae,Sphere as ie,EventDispatcher as ce,MOUSE as le,TOUCH as ue,Quaternion as he,Spherical as pe}from"three";var de=function(){var e=0,t=document.createElement("div");function n(e){return t.appendChild(e.dom),e}function s(n){for(var s=0;s<t.children.length;s++)t.children[s].style.display=s===n?"block":"none";e=n}t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",t.addEventListener("click",(function(n){n.preventDefault(),s(++e%t.children.length)}),!1);var o=(performance||Date).now(),r=o,a=0,i=n(new de.Panel("FPS","#0ff","#002")),c=n(new de.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var l=n(new de.Panel("MB","#f08","#201"));return s(0),{REVISION:16,dom:t,addPanel:n,showPanel:s,begin:function(){o=(performance||Date).now()},end:function(){a++;var e=(performance||Date).now();if(c.update(e-o,200),e>=r+1e3&&(i.update(1e3*a/(e-r),100),r=e,a=0,l)){var t=performance.memory;l.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){o=this.end()},domElement:t,setMode:s}};de.Panel=function(e,t,n){var s=1/0,o=0,r=Math.round,a=r(window.devicePixelRatio||1),i=80*a,c=48*a,l=3*a,u=2*a,h=3*a,p=15*a,d=74*a,m=30*a,f=document.createElement("canvas");f.width=i,f.height=c,f.style.cssText="width:80px;height:48px";var g=f.getContext("2d");return g.font="bold "+9*a+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=n,g.fillRect(0,0,i,c),g.fillStyle=t,g.fillText(e,l,u),g.fillRect(h,p,d,m),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(h,p,d,m),{dom:f,update:function(c,T){s=Math.min(s,c),o=Math.max(o,c),g.fillStyle=n,g.globalAlpha=1,g.fillRect(0,0,i,p),g.fillStyle=t,g.fillText(r(c)+" "+e+" ("+r(s)+"-"+r(o)+")",l,u),g.drawImage(f,h+a,p,d-a,m,h,p,d-a,m),g.fillRect(h+d-a,p,a,m),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(h+d-a,p,a,r((1-c/T)*m))}}};class me extends e{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new xe(e)})),this.register((function(e){return new Ee(e)})),this.register((function(e){return new ye(e)})),this.register((function(e){return new ve(e)})),this.register((function(e){return new Te(e)})),this.register((function(e){return new Re(e)}))}load(e,s,o,r){const a=this;let i;i=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:t.extractUrlBase(e),this.manager.itemStart(e);const c=function(t){r?r(t):console.error(t),a.manager.itemError(e),a.manager.itemEnd(e)},l=new n(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,(function(t){try{a.parse(t,i,(function(t){s(t),a.manager.itemEnd(e)}),c)}catch(n){c(n)}}),o,c)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,n,s,o){let r;const a={},i={};if("string"==typeof e)r=e;else{if(t.decodeText(new Uint8Array(e,0,4))===we){try{a[ge.KHR_BINARY_GLTF]=new Se(e)}catch(u){return void(o&&o(u))}r=a[ge.KHR_BINARY_GLTF].content}else r=t.decodeText(new Uint8Array(e))}const c=JSON.parse(r);if(void 0===c.asset||c.asset.version[0]<2)return void(o&&o(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const l=new ot(c,{path:n||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let t=0;t<this.pluginCallbacks.length;t++){const e=this.pluginCallbacks[t](l);i[e.name]=e,a[e.name]=!0}if(c.extensionsUsed)for(let t=0;t<c.extensionsUsed.length;++t){const e=c.extensionsUsed[t],n=c.extensionsRequired||[];switch(e){case ge.KHR_MATERIALS_UNLIT:a[e]=new be;break;case ge.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:a[e]=new Pe;break;case ge.KHR_DRACO_MESH_COMPRESSION:a[e]=new _e(c,this.dracoLoader);break;case ge.KHR_TEXTURE_TRANSFORM:a[e]=new Le;break;case ge.KHR_MESH_QUANTIZATION:a[e]=new Ne;break;default:n.indexOf(e)>=0&&void 0===i[e]&&console.warn('THREE.GLTFLoader: Unknown extension "'+e+'".')}}l.setExtensions(a),l.setPlugins(i),l.parse(s,o)}}function fe(){let e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const ge={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class Te{constructor(e){this.parser=e,this.name=ge.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,s=t.length;n<s;n++){const s=t[n];s.extensions&&s.extensions[this.name]&&void 0!==s.extensions[this.name].light&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let i=t.cache.get(n);if(i)return i;const c=t.json,l=((c.extensions&&c.extensions[this.name]||{}).lights||[])[e];let u;const h=new s(16777215);void 0!==l.color&&h.fromArray(l.color);const p=void 0!==l.range?l.range:0;switch(l.type){case"directional":u=new a(h),u.target.position.set(0,0,-1),u.add(u.target);break;case"point":u=new r(h),u.distance=p;break;case"spot":u=new o(h),u.distance=p,l.spot=l.spot||{},l.spot.innerConeAngle=void 0!==l.spot.innerConeAngle?l.spot.innerConeAngle:0,l.spot.outerConeAngle=void 0!==l.spot.outerConeAngle?l.spot.outerConeAngle:Math.PI/4,u.angle=l.spot.outerConeAngle,u.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,u.target.position.set(0,0,-1),u.add(u.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return u.position.set(0,0,0),u.decay=2,void 0!==l.intensity&&(u.intensity=l.intensity),u.name=t.createUniqueName(l.name||"light_"+e),i=Promise.resolve(u),t.cache.add(n,i),i}createNodeAttachment(e){const t=this,n=this.parser,s=n.json.nodes[e],o=(s.extensions&&s.extensions[this.name]||{}).light;return void 0===o?null:this._loadLight(o).then((function(e){return n._getNodeRef(t.cache,o,e)}))}}class be{constructor(){this.name=ge.KHR_MATERIALS_UNLIT}getMaterialType(){return i}extendParams(e,t,n){const o=[];e.color=new s(1,1,1),e.opacity=1;const r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const t=r.baseColorFactor;e.color.fromArray(t),e.opacity=t[3]}void 0!==r.baseColorTexture&&o.push(n.assignTexture(e,"map",r.baseColorTexture))}return Promise.all(o)}}class xe{constructor(e){this.parser=e,this.name=ge.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?c:null}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],r=s.extensions[this.name];if(void 0!==r.clearcoatFactor&&(t.clearcoat=r.clearcoatFactor),void 0!==r.clearcoatTexture&&o.push(n.assignTexture(t,"clearcoatMap",r.clearcoatTexture)),void 0!==r.clearcoatRoughnessFactor&&(t.clearcoatRoughness=r.clearcoatRoughnessFactor),void 0!==r.clearcoatRoughnessTexture&&o.push(n.assignTexture(t,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),void 0!==r.clearcoatNormalTexture&&(o.push(n.assignTexture(t,"clearcoatNormalMap",r.clearcoatNormalTexture)),void 0!==r.clearcoatNormalTexture.scale)){const e=r.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new l(e,-e)}return Promise.all(o)}}class ve{constructor(e){this.parser=e,this.name=ge.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?c:null}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],r=s.extensions[this.name];return void 0!==r.transmissionFactor&&(t.transmission=r.transmissionFactor),void 0!==r.transmissionTexture&&o.push(n.assignTexture(t,"transmissionMap",r.transmissionTexture)),Promise.all(o)}}class Ee{constructor(e){this.parser=e,this.name=ge.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,s=n.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const o=s.extensions[this.name],r=n.images[o.source],a=t.options.ktx2Loader;if(!a){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r,a)}}class ye{constructor(e){this.parser=e,this.name=ge.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,s=n.json,o=s.textures[e];if(!o.extensions||!o.extensions[t])return null;const r=o.extensions[t],a=s.images[r.source];let i=n.textureLoader;if(a.uri){const e=n.options.manager.getHandler(a.uri);null!==e&&(i=e)}return this.detectSupport().then((function(o){if(o)return n.loadTextureImage(e,a,i);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class Re{constructor(e){this.name=ge.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const e=n.extensions[this.name],s=this.parser.getDependency("buffer",e.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([s,o.ready]).then((function(t){const n=e.byteOffset||0,s=e.byteLength||0,r=e.count,a=e.byteStride,i=new ArrayBuffer(r*a),c=new Uint8Array(t[0],n,s);return o.decodeGltfBuffer(new Uint8Array(i),r,a,c,e.mode,e.filter),i}))}return null}}const we="glTF",Ae=1313821514,Me=5130562;class Se{constructor(e){this.name=ge.KHR_BINARY_GLTF,this.content=null,this.body=null;const n=new DataView(e,0,12);if(this.header={magic:t.decodeText(new Uint8Array(e.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==we)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-12,o=new DataView(e,12);let r=0;for(;r<s;){const n=o.getUint32(r,!0);r+=4;const s=o.getUint32(r,!0);if(r+=4,s===Ae){const s=new Uint8Array(e,12+r,n);this.content=t.decodeText(s)}else if(s===Me){const t=12+r;this.body=e.slice(t,t+n)}r+=n}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class _e{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=ge.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,s=this.dracoLoader,o=e.extensions[this.name].bufferView,r=e.extensions[this.name].attributes,a={},i={},c={};for(const l in r){const e=Xe[l]||l.toLowerCase();a[e]=r[l]}for(const l in e.attributes){const t=Xe[l]||l.toLowerCase();if(void 0!==r[l]){const s=n.accessors[e.attributes[l]],o=Ge[s.componentType];c[t]=o,i[t]=!0===s.normalized}}return t.getDependency("bufferView",o).then((function(e){return new Promise((function(t){s.decodeDracoFile(e,(function(e){for(const t in e.attributes){const n=e.attributes[t],s=i[t];void 0!==s&&(n.normalized=s)}t(e)}),a,c)}))}))}}class Le{constructor(){this.name=ge.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class Oe extends R{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),n=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),o=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),r=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),a=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),i={specular:{value:(new s).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=i,this.onBeforeCompile=function(e){for(const t in i)e.uniforms[t]=i[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",o).replace("#include <metalnessmap_fragment>",r).replace("#include <lights_physical_fragment>",a)},Object.defineProperties(this,{specular:{get:function(){return i.specular.value},set:function(e){i.specular.value=e}},specularMap:{get:function(){return i.specularMap.value},set:function(e){i.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return i.glossiness.value},set:function(e){i.glossiness.value=e}},glossinessMap:{get:function(){return i.glossinessMap.value},set:function(e){i.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class Pe{constructor(){this.name=ge.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return Oe}extendParams(e,t,n){const o=t.extensions[this.name];e.color=new s(1,1,1),e.opacity=1;const r=[];if(Array.isArray(o.diffuseFactor)){const t=o.diffuseFactor;e.color.fromArray(t),e.opacity=t[3]}if(void 0!==o.diffuseTexture&&r.push(n.assignTexture(e,"map",o.diffuseTexture)),e.emissive=new s(0,0,0),e.glossiness=void 0!==o.glossinessFactor?o.glossinessFactor:1,e.specular=new s(1,1,1),Array.isArray(o.specularFactor)&&e.specular.fromArray(o.specularFactor),void 0!==o.specularGlossinessTexture){const t=o.specularGlossinessTexture;r.push(n.assignTexture(e,"glossinessMap",t)),r.push(n.assignTexture(e,"specularMap",t))}return Promise.all(r)}createMaterial(e){const t=new Oe(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=u,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}class Ne{constructor(){this.name=ge.KHR_MESH_QUANTIZATION}}class Ie extends X{constructor(e,t,n,s){super(e,t,n,s)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,s=this.valueSize,o=e*s*3+s;for(let r=0;r!==s;r++)t[r]=n[o+r];return t}}Ie.prototype.beforeStart_=Ie.prototype.copySampleValue_,Ie.prototype.afterEnd_=Ie.prototype.copySampleValue_,Ie.prototype.interpolate_=function(e,t,n,s){const o=this.resultBuffer,r=this.sampleValues,a=this.valueSize,i=2*a,c=3*a,l=s-t,u=(n-t)/l,h=u*u,p=h*u,d=e*c,m=d-c,f=-2*p+3*h,g=p-h,T=1-f,b=g-h+u;for(let x=0;x!==a;x++){const e=r[m+x+a],t=r[m+x+i]*l,n=r[d+x+a],s=r[d+x]*l;o[x]=T*e+b*t+f*n+g*s}return o};const Ce=0,He=1,Ue=2,ke=3,De=4,Fe=5,je=6,Ge={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Ke={9728:z,9729:T,9984:Y,9985:q,9986:Z,9987:b},Be={33071:W,33648:Q,10497:x},Ve={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Xe={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},ze={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Ye={CUBICSPLINE:void 0,LINEAR:D,STEP:J},qe="OPAQUE",Ze="MASK",We="BLEND";function Qe(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}function Je(e,t,n){for(const s in n.extensions)void 0===e[s]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[s]=n.extensions[s])}function $e(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function et(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let n=0,s=t.weights.length;n<s;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){const n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(let t=0,s=n.length;t<s;t++)e.morphTargetDictionary[n[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function tt(e){const t=e.extensions&&e.extensions[ge.KHR_DRACO_MESH_COMPRESSION];let n;return n=t?"draco:"+t.bufferView+":"+t.indices+":"+nt(t.attributes):e.indices+":"+nt(e.attributes)+":"+e.mode,n}function nt(e){let t="";const n=Object.keys(e).sort();for(let s=0,o=n.length;s<o;s++)t+=n[s]+":"+e[n[s]]+";";return t}function st(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class ot{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new fe,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},"undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new h(this.options.manager):this.textureLoader=new p(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new n(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,s=this.json,o=this.extensions;this.cache.removeAll(),this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])})).then((function(t){const r={scene:t[0][s.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:s.asset,parser:n,userData:{}};Je(o,r,s),$e(r,s),Promise.all(n._invokeAll((function(e){return e.afterRoot&&e.afterRoot(r)}))).then((function(){e(r)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let s=0,o=t.length;s<o;s++){const n=t[s].joints;for(let t=0,s=n.length;t<s;t++)e[n[t]].isBone=!0}for(let s=0,o=e.length;s<o;s++){const t=e[s];void 0!==t.mesh&&(this._addNodeRef(this.meshCache,t.mesh),void 0!==t.skin&&(n[t.mesh].isSkinnedMesh=!0)),void 0!==t.camera&&this._addNodeRef(this.cameraCache,t.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const s=n.clone();return s.name+="_instance_"+e.uses[t]++,s}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const s=e(t[n]);if(s)return s}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let s=0;s<t.length;s++){const o=e(t[s]);o&&n.push(o)}return n}getDependency(e,t){const n=e+":"+t;let s=this.cache.get(n);if(!s){switch(e){case"scene":s=this.loadScene(t);break;case"node":s=this.loadNode(t);break;case"mesh":s=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":s=this.loadAccessor(t);break;case"bufferView":s=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":s=this.loadBuffer(t);break;case"material":s=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":s=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":s=this.loadSkin(t);break;case"animation":s=this.loadAnimation(t);break;case"camera":s=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,s)}return s}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,s=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(s.map((function(t,s){return n.getDependency(e,s)}))),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[ge.KHR_BINARY_GLTF].body);const s=this.options;return new Promise((function(e,o){n.load(Qe(t.uri,s.path),e,void 0,(function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){const n=t.byteLength||0,s=t.byteOffset||0;return e.slice(s,s+n)}))}loadAccessor(e){const t=this,n=this.json,s=this.json.accessors[e];if(void 0===s.bufferView&&void 0===s.sparse)return Promise.resolve(null);const o=[];return void 0!==s.bufferView?o.push(this.getDependency("bufferView",s.bufferView)):o.push(null),void 0!==s.sparse&&(o.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(o).then((function(e){const o=e[0],r=Ve[s.type],a=Ge[s.componentType],i=a.BYTES_PER_ELEMENT,c=i*r,l=s.byteOffset||0,u=void 0!==s.bufferView?n.bufferViews[s.bufferView].byteStride:void 0,h=!0===s.normalized;let p,g;if(u&&u!==c){const e=Math.floor(l/u),n="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+e+":"+s.count;let c=t.cache.get(n);c||(p=new a(o,e*u,s.count*u/i),c=new d(p,u/i),t.cache.add(n,c)),g=new m(c,r,l%u/i,h)}else p=null===o?new a(s.count*r):new a(o,l,s.count*r),g=new f(p,r,h);if(void 0!==s.sparse){const t=Ve.SCALAR,n=Ge[s.sparse.indices.componentType],i=s.sparse.indices.byteOffset||0,c=s.sparse.values.byteOffset||0,l=new n(e[1],i,s.sparse.count*t),u=new a(e[2],c,s.sparse.count*r);null!==o&&(g=new f(g.array.slice(),g.itemSize,g.normalized));for(let e=0,s=l.length;e<s;e++){const t=l[e];if(g.setX(t,u[e*r]),r>=2&&g.setY(t,u[e*r+1]),r>=3&&g.setZ(t,u[e*r+2]),r>=4&&g.setW(t,u[e*r+3]),r>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return g}))}loadTexture(e){const t=this.json,n=this.options,s=t.textures[e],o=t.images[s.source];let r=this.textureLoader;if(o.uri){const e=n.manager.getHandler(o.uri);null!==e&&(r=e)}return this.loadTextureImage(e,o,r)}loadTextureImage(e,t,n){const s=this,o=this.json,r=this.options,a=o.textures[e],i=(t.uri||t.bufferView)+":"+a.sampler;if(this.textureCache[i])return this.textureCache[i];const c=self.URL||self.webkitURL;let l=t.uri||"",u=!1,h=!0;const p=l.search(/\.jpe?g($|\?)/i)>0||0===l.search(/^data\:image\/jpeg/);if(("image/jpeg"===t.mimeType||p)&&(h=!1),void 0!==t.bufferView)l=s.getDependency("bufferView",t.bufferView).then((function(e){if("image/png"===t.mimeType){const t=new DataView(e,25,1).getUint8(0,!1);h=6===t||4===t||3===t}u=!0;const n=new Blob([e],{type:t.mimeType});return l=c.createObjectURL(n),l}));else if(void 0===t.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const d=Promise.resolve(l).then((function(e){return new Promise((function(t,s){let o=t;!0===n.isImageBitmapLoader&&(o=function(e){const n=new ee(e);n.needsUpdate=!0,t(n)}),n.load(Qe(e,r.path),o,void 0,s)}))})).then((function(t){!0===u&&c.revokeObjectURL(l),t.flipY=!1,a.name&&(t.name=a.name),h||(t.format=g);const n=(o.samplers||{})[a.sampler]||{};return t.magFilter=Ke[n.magFilter]||T,t.minFilter=Ke[n.minFilter]||b,t.wrapS=Be[n.wrapS]||x,t.wrapT=Be[n.wrapT]||x,s.associations.set(t,{type:"textures",index:e}),t})).catch((function(){return console.error("THREE.GLTFLoader: Couldn't load texture",l),null}));return this.textureCache[i]=d,d}assignTexture(e,t,n){const s=this;return this.getDependency("texture",n.index).then((function(o){if(void 0===n.texCoord||0==n.texCoord||"aoMap"===t&&1==n.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),s.extensions[ge.KHR_TEXTURE_TRANSFORM]){const e=void 0!==n.extensions?n.extensions[ge.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=s.associations.get(o);o=s.extensions[ge.KHR_TEXTURE_TRANSFORM].extendTexture(o,e),s.associations.set(o,t)}}e[t]=o}))}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const s=void 0!==t.attributes.tangent,o=void 0!==t.attributes.color,r=void 0===t.attributes.normal,a=Object.keys(t.morphAttributes).length>0,i=a&&void 0!==t.morphAttributes.normal;if(e.isPoints){const e="PointsMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new v,E.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,t.sizeAttenuation=!1,this.cache.add(e,t)),n=t}else if(e.isLine){const e="LineBasicMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new y,E.prototype.copy.call(t,n),t.color.copy(n.color),this.cache.add(e,t)),n=t}if(s||o||r||a){let e="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(e+="specular-glossiness:"),s&&(e+="vertex-tangents:"),o&&(e+="vertex-colors:"),r&&(e+="flat-shading:"),a&&(e+="morph-targets:"),i&&(e+="morph-normals:");let t=this.cache.get(e);t||(t=n.clone(),o&&(t.vertexColors=!0),r&&(t.flatShading=!0),a&&(t.morphTargets=!0),i&&(t.morphNormals=!0),s&&(t.vertexTangents=!0,t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(n))),n=t}n.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=n}getMaterialType(){return R}loadMaterial(e){const t=this,n=this.json,o=this.extensions,r=n.materials[e];let a;const c={},u=r.extensions||{},h=[];if(u[ge.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const e=o[ge.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];a=e.getMaterialType(),h.push(e.extendParams(c,r,t))}else if(u[ge.KHR_MATERIALS_UNLIT]){const e=o[ge.KHR_MATERIALS_UNLIT];a=e.getMaterialType(),h.push(e.extendParams(c,r,t))}else{const n=r.pbrMetallicRoughness||{};if(c.color=new s(1,1,1),c.opacity=1,Array.isArray(n.baseColorFactor)){const e=n.baseColorFactor;c.color.fromArray(e),c.opacity=e[3]}void 0!==n.baseColorTexture&&h.push(t.assignTexture(c,"map",n.baseColorTexture)),c.metalness=void 0!==n.metallicFactor?n.metallicFactor:1,c.roughness=void 0!==n.roughnessFactor?n.roughnessFactor:1,void 0!==n.metallicRoughnessTexture&&(h.push(t.assignTexture(c,"metalnessMap",n.metallicRoughnessTexture)),h.push(t.assignTexture(c,"roughnessMap",n.metallicRoughnessTexture))),a=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),h.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,c)}))))}!0===r.doubleSided&&(c.side=w);const p=r.alphaMode||qe;return p===We?(c.transparent=!0,c.depthWrite=!1):(c.transparent=!1,p===Ze&&(c.alphaTest=void 0!==r.alphaCutoff?r.alphaCutoff:.5)),void 0!==r.normalTexture&&a!==i&&(h.push(t.assignTexture(c,"normalMap",r.normalTexture)),c.normalScale=new l(1,-1),void 0!==r.normalTexture.scale&&c.normalScale.set(r.normalTexture.scale,-r.normalTexture.scale)),void 0!==r.occlusionTexture&&a!==i&&(h.push(t.assignTexture(c,"aoMap",r.occlusionTexture)),void 0!==r.occlusionTexture.strength&&(c.aoMapIntensity=r.occlusionTexture.strength)),void 0!==r.emissiveFactor&&a!==i&&(c.emissive=(new s).fromArray(r.emissiveFactor)),void 0!==r.emissiveTexture&&a!==i&&h.push(t.assignTexture(c,"emissiveMap",r.emissiveTexture)),Promise.all(h).then((function(){let n;return n=a===Oe?o[ge.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(c):new a(c),r.name&&(n.name=r.name),n.map&&(n.map.encoding=A),n.emissiveMap&&(n.emissiveMap.encoding=A),$e(n,r),t.associations.set(n,{type:"materials",index:e}),r.extensions&&Je(o,n,r),n}))}createUniqueName(e){const t=M.sanitizeNodeName(e||"");let n=t;for(let s=1;this.nodeNamesUsed[n];++s)n=t+"_"+s;return this.nodeNamesUsed[n]=!0,n}loadGeometries(e){const t=this,n=this.extensions,s=this.primitiveCache;function o(e){return n[ge.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(n){return at(n,e,t)}))}const r=[];for(let a=0,i=e.length;a<i;a++){const n=e[a],i=tt(n),c=s[i];if(c)r.push(c.promise);else{let e;e=n.extensions&&n.extensions[ge.KHR_DRACO_MESH_COMPRESSION]?o(n):at(new S,n,t),s[i]={primitive:n,promise:e},r.push(e)}}return Promise.all(r)}loadMesh(e){const t=this,n=this.json,s=this.extensions,o=n.meshes[e],r=o.primitives,a=[];for(let c=0,l=r.length;c<l;c++){const e=void 0===r[c].material?(void 0===(i=this.cache).DefaultMaterial&&(i.DefaultMaterial=new R({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:$})),i.DefaultMaterial):this.getDependency("material",r[c].material);a.push(e)}var i;return a.push(t.loadGeometries(r)),Promise.all(a).then((function(n){const a=n.slice(0,n.length-1),i=n[n.length-1],c=[];for(let u=0,h=i.length;u<h;u++){const n=i[u],l=r[u];let h;const p=a[u];if(l.mode===De||l.mode===Fe||l.mode===je||void 0===l.mode)h=!0===o.isSkinnedMesh?new _(n,p):new L(n,p),!0!==h.isSkinnedMesh||h.geometry.attributes.skinWeight.normalized||h.normalizeSkinWeights(),l.mode===Fe?h.geometry=it(h.geometry,te):l.mode===je&&(h.geometry=it(h.geometry,V));else if(l.mode===He)h=new O(n,p);else if(l.mode===ke)h=new P(n,p);else if(l.mode===Ue)h=new N(n,p);else{if(l.mode!==Ce)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+l.mode);h=new I(n,p)}Object.keys(h.geometry.morphAttributes).length>0&&et(h,o),h.name=t.createUniqueName(o.name||"mesh_"+e),$e(h,o),l.extensions&&Je(s,h,l),t.assignFinalMaterial(h),c.push(h)}if(1===c.length)return c[0];const l=new C;for(let e=0,t=c.length;e<t;e++)l.add(c[e]);return l}))}loadCamera(e){let t;const n=this.json.cameras[e],s=n[n.type];if(s)return"perspective"===n.type?t=new H(U.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):"orthographic"===n.type&&(t=new k(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),$e(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],n={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return n.inverseBindMatrices=e,n}))}loadAnimation(e){const t=this.json.animations[e],n=[],s=[],o=[],r=[],a=[];for(let i=0,c=t.channels.length;i<c;i++){const e=t.channels[i],c=t.samplers[e.sampler],l=e.target,u=void 0!==l.node?l.node:l.id,h=void 0!==t.parameters?t.parameters[c.input]:c.input,p=void 0!==t.parameters?t.parameters[c.output]:c.output;n.push(this.getDependency("node",u)),s.push(this.getDependency("accessor",h)),o.push(this.getDependency("accessor",p)),r.push(c),a.push(l)}return Promise.all([Promise.all(n),Promise.all(s),Promise.all(o),Promise.all(r),Promise.all(a)]).then((function(n){const s=n[0],o=n[1],r=n[2],a=n[3],i=n[4],c=[];for(let e=0,t=s.length;e<t;e++){const t=s[e],n=o[e],l=r[e],u=a[e],h=i[e];if(void 0===t)continue;let p;switch(t.updateMatrix(),t.matrixAutoUpdate=!0,ze[h.path]){case ze.weights:p=oe;break;case ze.rotation:p=se;break;case ze.position:case ze.scale:default:p=ne}const d=t.name?t.name:t.uuid,m=void 0!==u.interpolation?Ye[u.interpolation]:D,f=[];ze[h.path]===ze.weights?t.traverse((function(e){!0===e.isMesh&&e.morphTargetInfluences&&f.push(e.name?e.name:e.uuid)})):f.push(d);let g=l.array;if(l.normalized){const e=st(g.constructor),t=new Float32Array(g.length);for(let n=0,s=g.length;n<s;n++)t[n]=g[n]*e;g=t}for(let e=0,s=f.length;e<s;e++){const t=new p(f[e]+"."+ze[h.path],n.array,g,m);"CUBICSPLINE"===u.interpolation&&(t.createInterpolant=function(e){return new Ie(this.times,this.values,this.getValueSize()/3,e)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),c.push(t)}}const l=t.name?t.name:"animation_"+e;return new F(l,void 0,c)}))}createNodeMesh(e){const t=this.json,n=this,s=t.nodes[e];return void 0===s.mesh?null:n.getDependency("mesh",s.mesh).then((function(e){const t=n._getNodeRef(n.meshCache,s.mesh,e);return void 0!==s.weights&&t.traverse((function(e){if(e.isMesh)for(let t=0,n=s.weights.length;t<n;t++)e.morphTargetInfluences[t]=s.weights[t]})),t}))}loadNode(e){const t=this.json,n=this.extensions,s=this,o=t.nodes[e],r=o.name?s.createUniqueName(o.name):"";return function(){const t=[],n=s._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return n&&t.push(n),void 0!==o.camera&&t.push(s.getDependency("camera",o.camera).then((function(e){return s._getNodeRef(s.cameraCache,o.camera,e)}))),s._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){t.push(e)})),Promise.all(t)}().then((function(t){let a;if(a=!0===o.isBone?new j:t.length>1?new C:1===t.length?t[0]:new G,a!==t[0])for(let e=0,n=t.length;e<n;e++)a.add(t[e]);if(o.name&&(a.userData.name=o.name,a.name=r),$e(a,o),o.extensions&&Je(n,a,o),void 0!==o.matrix){const e=new K;e.fromArray(o.matrix),a.applyMatrix4(e)}else void 0!==o.translation&&a.position.fromArray(o.translation),void 0!==o.rotation&&a.quaternion.fromArray(o.rotation),void 0!==o.scale&&a.scale.fromArray(o.scale);return s.associations.set(a,{type:"nodes",index:e}),a}))}loadScene(e){const t=this.json,n=this.extensions,s=this.json.scenes[e],o=this,r=new C;s.name&&(r.name=o.createUniqueName(s.name)),$e(r,s),s.extensions&&Je(n,r,s);const a=s.nodes||[],i=[];for(let c=0,l=a.length;c<l;c++)i.push(rt(a[c],r,t,o));return Promise.all(i).then((function(){return r}))}}function rt(e,t,n,s){const o=n.nodes[e];return s.getDependency("node",e).then((function(e){if(void 0===o.skin)return e;let t;return s.getDependency("skin",o.skin).then((function(e){t=e;const n=[];for(let o=0,r=t.joints.length;o<r;o++)n.push(s.getDependency("node",t.joints[o]));return Promise.all(n)})).then((function(n){return e.traverse((function(e){if(!e.isMesh)return;const s=[],o=[];for(let r=0,a=n.length;r<a;r++){const e=n[r];if(e){s.push(e);const n=new K;void 0!==t.inverseBindMatrices&&n.fromArray(t.inverseBindMatrices.array,16*r),o.push(n)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[r])}e.bind(new B(s,o),e.matrixWorld)})),e}))})).then((function(e){t.add(e);const r=[];if(o.children){const t=o.children;for(let o=0,a=t.length;o<a;o++){const a=t[o];r.push(rt(a,e,n,s))}}return Promise.all(r)}))}function at(e,t,n){const s=t.attributes,o=[];function r(t,s){return n.getDependency("accessor",t).then((function(t){e.setAttribute(s,t)}))}for(const a in s){const t=Xe[a]||a.toLowerCase();t in e.attributes||o.push(r(s[a],t))}if(void 0!==t.indices&&!e.index){const s=n.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));o.push(s)}return $e(e,t),function(e,t,n){const s=t.attributes,o=new re;if(void 0===s.POSITION)return;{const e=n.json.accessors[s.POSITION],t=e.min,r=e.max;if(void 0===t||void 0===r)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(o.set(new ae(t[0],t[1],t[2]),new ae(r[0],r[1],r[2])),e.normalized){const t=st(Ge[e.componentType]);o.min.multiplyScalar(t),o.max.multiplyScalar(t)}}const r=t.targets;if(void 0!==r){const e=new ae,t=new ae;for(let s=0,o=r.length;s<o;s++){const o=r[s];if(void 0!==o.POSITION){const s=n.json.accessors[o.POSITION],r=s.min,a=s.max;if(void 0!==r&&void 0!==a){if(t.setX(Math.max(Math.abs(r[0]),Math.abs(a[0]))),t.setY(Math.max(Math.abs(r[1]),Math.abs(a[1]))),t.setZ(Math.max(Math.abs(r[2]),Math.abs(a[2]))),s.normalized){const e=st(Ge[s.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}o.expandByVector(e)}e.boundingBox=o;const a=new ie;o.getCenter(a.center),a.radius=o.min.distanceTo(o.max)/2,e.boundingSphere=a}(e,t,n),Promise.all(o).then((function(){return void 0!==t.targets?function(e,t,n){let s=!1,o=!1;for(let i=0,c=t.length;i<c;i++){const e=t[i];if(void 0!==e.POSITION&&(s=!0),void 0!==e.NORMAL&&(o=!0),s&&o)break}if(!s&&!o)return Promise.resolve(e);const r=[],a=[];for(let i=0,c=t.length;i<c;i++){const c=t[i];if(s){const t=void 0!==c.POSITION?n.getDependency("accessor",c.POSITION):e.attributes.position;r.push(t)}if(o){const t=void 0!==c.NORMAL?n.getDependency("accessor",c.NORMAL):e.attributes.normal;a.push(t)}}return Promise.all([Promise.all(r),Promise.all(a)]).then((function(t){const n=t[0],r=t[1];return s&&(e.morphAttributes.position=n),o&&(e.morphAttributes.normal=r),e.morphTargetsRelative=!0,e}))}(e,t.targets,n):e}))}function it(e,t){let n=e.getIndex();if(null===n){const t=[],s=e.getAttribute("position");if(void 0===s)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<s.count;e++)t.push(e);e.setIndex(t),n=e.getIndex()}const s=n.count-2,o=[];if(t===V)for(let a=1;a<=s;a++)o.push(n.getX(0)),o.push(n.getX(a)),o.push(n.getX(a+1));else for(let a=0;a<s;a++)a%2==0?(o.push(n.getX(a)),o.push(n.getX(a+1)),o.push(n.getX(a+2))):(o.push(n.getX(a+2)),o.push(n.getX(a+1)),o.push(n.getX(a)));o.length/3!==s&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=e.clone();return r.setIndex(o),r}const ct={type:"change"},lt={type:"start"},ut={type:"end"};class ht extends ce{constructor(e,t){super(),void 0===t&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new ae,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:le.ROTATE,MIDDLE:le.DOLLY,RIGHT:le.PAN},this.touches={ONE:ue.ROTATE,TWO:ue.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.listenToKeyEvents=function(e){e.addEventListener("keydown",V),this._domElementKeyEvents=e},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(ct),n.update(),o=s.NONE},this.update=function(){const t=new ae,l=(new he).setFromUnitVectors(e.up,new ae(0,1,0)),p=l.clone().invert(),d=new ae,m=new he,f=2*Math.PI;return function(){const e=n.object.position;t.copy(e).sub(n.target),t.applyQuaternion(l),a.setFromVector3(t),n.autoRotate&&o===s.NONE&&w(2*Math.PI/60/60*n.autoRotateSpeed),n.enableDamping?(a.theta+=i.theta*n.dampingFactor,a.phi+=i.phi*n.dampingFactor):(a.theta+=i.theta,a.phi+=i.phi);let g=n.minAzimuthAngle,T=n.maxAzimuthAngle;return isFinite(g)&&isFinite(T)&&(g<-Math.PI?g+=f:g>Math.PI&&(g-=f),T<-Math.PI?T+=f:T>Math.PI&&(T-=f),a.theta=g<=T?Math.max(g,Math.min(T,a.theta)):a.theta>(g+T)/2?Math.max(g,a.theta):Math.min(T,a.theta)),a.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,a.phi)),a.makeSafe(),a.radius*=c,a.radius=Math.max(n.minDistance,Math.min(n.maxDistance,a.radius)),!0===n.enableDamping?n.target.addScaledVector(u,n.dampingFactor):n.target.add(u),t.setFromSpherical(a),t.applyQuaternion(p),e.copy(n.target).add(t),n.object.lookAt(n.target),!0===n.enableDamping?(i.theta*=1-n.dampingFactor,i.phi*=1-n.dampingFactor,u.multiplyScalar(1-n.dampingFactor)):(i.set(0,0,0),u.set(0,0,0)),c=1,!!(h||d.distanceToSquared(n.object.position)>r||8*(1-m.dot(n.object.quaternion))>r)&&(n.dispatchEvent(ct),d.copy(n.object.position),m.copy(n.object.quaternion),h=!1,!0)}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",X),n.domElement.removeEventListener("pointerdown",F),n.domElement.removeEventListener("pointercancel",K),n.domElement.removeEventListener("wheel",B),n.domElement.ownerDocument.removeEventListener("pointermove",j),n.domElement.ownerDocument.removeEventListener("pointerup",G),null!==n._domElementKeyEvents&&n._domElementKeyEvents.removeEventListener("keydown",V)};const n=this,s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let o=s.NONE;const r=1e-6,a=new pe,i=new pe;let c=1;const u=new ae;let h=!1;const p=new l,d=new l,m=new l,f=new l,g=new l,T=new l,b=new l,x=new l,v=new l,E=[],y={};function R(){return Math.pow(.95,n.zoomSpeed)}function w(e){i.theta-=e}function A(e){i.phi-=e}const M=function(){const e=new ae;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),u.add(e)}}(),S=function(){const e=new ae;return function(t,s){!0===n.screenSpacePanning?e.setFromMatrixColumn(s,1):(e.setFromMatrixColumn(s,0),e.crossVectors(n.object.up,e)),e.multiplyScalar(t),u.add(e)}}(),_=function(){const e=new ae;return function(t,s){const o=n.domElement;if(n.object.isPerspectiveCamera){const r=n.object.position;e.copy(r).sub(n.target);let a=e.length();a*=Math.tan(n.object.fov/2*Math.PI/180),M(2*t*a/o.clientHeight,n.object.matrix),S(2*s*a/o.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(M(t*(n.object.right-n.object.left)/n.object.zoom/o.clientWidth,n.object.matrix),S(s*(n.object.top-n.object.bottom)/n.object.zoom/o.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function L(e){n.object.isPerspectiveCamera?c/=e:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*e)),n.object.updateProjectionMatrix(),h=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function O(e){n.object.isPerspectiveCamera?c*=e:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/e)),n.object.updateProjectionMatrix(),h=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function P(e){p.set(e.clientX,e.clientY)}function N(e){f.set(e.clientX,e.clientY)}function I(){if(1===E.length)p.set(E[0].pageX,E[0].pageY);else{const e=.5*(E[0].pageX+E[1].pageX),t=.5*(E[0].pageY+E[1].pageY);p.set(e,t)}}function C(){if(1===E.length)f.set(E[0].pageX,E[0].pageY);else{const e=.5*(E[0].pageX+E[1].pageX),t=.5*(E[0].pageY+E[1].pageY);f.set(e,t)}}function H(){const e=E[0].pageX-E[1].pageX,t=E[0].pageY-E[1].pageY,n=Math.sqrt(e*e+t*t);b.set(0,n)}function U(e){if(1==E.length)d.set(e.pageX,e.pageY);else{const t=q(e),n=.5*(e.pageX+t.x),s=.5*(e.pageY+t.y);d.set(n,s)}m.subVectors(d,p).multiplyScalar(n.rotateSpeed);const t=n.domElement;w(2*Math.PI*m.x/t.clientHeight),A(2*Math.PI*m.y/t.clientHeight),p.copy(d)}function k(e){if(1===E.length)g.set(e.pageX,e.pageY);else{const t=q(e),n=.5*(e.pageX+t.x),s=.5*(e.pageY+t.y);g.set(n,s)}T.subVectors(g,f).multiplyScalar(n.panSpeed),_(T.x,T.y),f.copy(g)}function D(e){const t=q(e),s=e.pageX-t.x,o=e.pageY-t.y,r=Math.sqrt(s*s+o*o);x.set(0,r),v.set(0,Math.pow(x.y/b.y,n.zoomSpeed)),L(v.y),b.copy(x)}function F(e){!1!==n.enabled&&(0===E.length&&(n.domElement.ownerDocument.addEventListener("pointermove",j),n.domElement.ownerDocument.addEventListener("pointerup",G)),function(e){E.push(e)}(e),"touch"===e.pointerType?function(e){switch(Y(e),E.length){case 1:switch(n.touches.ONE){case ue.ROTATE:if(!1===n.enableRotate)return;I(),o=s.TOUCH_ROTATE;break;case ue.PAN:if(!1===n.enablePan)return;C(),o=s.TOUCH_PAN;break;default:o=s.NONE}break;case 2:switch(n.touches.TWO){case ue.DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;n.enableZoom&&H(),n.enablePan&&C(),o=s.TOUCH_DOLLY_PAN;break;case ue.DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;n.enableZoom&&H(),n.enableRotate&&I(),o=s.TOUCH_DOLLY_ROTATE;break;default:o=s.NONE}break;default:o=s.NONE}o!==s.NONE&&n.dispatchEvent(lt)}(e):function(e){let t;switch(e.button){case 0:t=n.mouseButtons.LEFT;break;case 1:t=n.mouseButtons.MIDDLE;break;case 2:t=n.mouseButtons.RIGHT;break;default:t=-1}switch(t){case le.DOLLY:if(!1===n.enableZoom)return;!function(e){b.set(e.clientX,e.clientY)}(e),o=s.DOLLY;break;case le.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enablePan)return;N(e),o=s.PAN}else{if(!1===n.enableRotate)return;P(e),o=s.ROTATE}break;case le.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enableRotate)return;P(e),o=s.ROTATE}else{if(!1===n.enablePan)return;N(e),o=s.PAN}break;default:o=s.NONE}o!==s.NONE&&n.dispatchEvent(lt)}(e))}function j(e){!1!==n.enabled&&("touch"===e.pointerType?function(e){switch(Y(e),o){case s.TOUCH_ROTATE:if(!1===n.enableRotate)return;U(e),n.update();break;case s.TOUCH_PAN:if(!1===n.enablePan)return;k(e),n.update();break;case s.TOUCH_DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(e){n.enableZoom&&D(e),n.enablePan&&k(e)}(e),n.update();break;case s.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(e){n.enableZoom&&D(e),n.enableRotate&&U(e)}(e),n.update();break;default:o=s.NONE}}(e):function(e){if(!1===n.enabled)return;switch(o){case s.ROTATE:if(!1===n.enableRotate)return;!function(e){d.set(e.clientX,e.clientY),m.subVectors(d,p).multiplyScalar(n.rotateSpeed);const t=n.domElement;w(2*Math.PI*m.x/t.clientHeight),A(2*Math.PI*m.y/t.clientHeight),p.copy(d),n.update()}(e);break;case s.DOLLY:if(!1===n.enableZoom)return;!function(e){x.set(e.clientX,e.clientY),v.subVectors(x,b),v.y>0?L(R()):v.y<0&&O(R()),b.copy(x),n.update()}(e);break;case s.PAN:if(!1===n.enablePan)return;!function(e){g.set(e.clientX,e.clientY),T.subVectors(g,f).multiplyScalar(n.panSpeed),_(T.x,T.y),f.copy(g),n.update()}(e)}}(e))}function G(e){!1!==n.enabled&&(e.pointerType,n.dispatchEvent(ut),o=s.NONE,z(e),0===E.length&&(n.domElement.ownerDocument.removeEventListener("pointermove",j),n.domElement.ownerDocument.removeEventListener("pointerup",G)))}function K(e){z(e)}function B(e){!1===n.enabled||!1===n.enableZoom||o!==s.NONE&&o!==s.ROTATE||(e.preventDefault(),n.dispatchEvent(lt),function(e){e.deltaY<0?O(R()):e.deltaY>0&&L(R()),n.update()}(e),n.dispatchEvent(ut))}function V(e){!1!==n.enabled&&!1!==n.enablePan&&function(e){let t=!1;switch(e.code){case n.keys.UP:_(0,n.keyPanSpeed),t=!0;break;case n.keys.BOTTOM:_(0,-n.keyPanSpeed),t=!0;break;case n.keys.LEFT:_(n.keyPanSpeed,0),t=!0;break;case n.keys.RIGHT:_(-n.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),n.update())}(e)}function X(e){!1!==n.enabled&&e.preventDefault()}function z(e){delete y[e.pointerId];for(let t=0;t<E.length;t++)if(E[t].pointerId==e.pointerId)return void E.splice(t,1)}function Y(e){let t=y[e.pointerId];void 0===t&&(t=new l,y[e.pointerId]=t),t.set(e.pageX,e.pageY)}function q(e){const t=e.pointerId===E[0].pointerId?E[1]:E[0];return y[t.pointerId]}n.domElement.addEventListener("contextmenu",X),n.domElement.addEventListener("pointerdown",F),n.domElement.addEventListener("pointercancel",K),n.domElement.addEventListener("wheel",B,{passive:!1}),this.update()}}export{me as G,ht as O,de as S};
